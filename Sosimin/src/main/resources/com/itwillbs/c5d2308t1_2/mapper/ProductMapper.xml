<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.c5d2308t1_2.mapper.ProductMapper">
	<!-- 상품 목록 갯수 -->
	<select id="productListCount" resultType="int">
		SELECT COUNT(*)
		FROM Product
			<if test="id != ''">
				WHERE 
				gu = (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(member_address, ' ', -2), ' ', 1) AS member_address
				FROM Member
				WHERE member_id = #{sId})		
			</if>
	</select>
	
	
	
	<!-- 상품 목록 조회 -->
	<select id="selectProductList" resultType="map"> 
		SELECT p.product_id, product_category, p.member_id, product_board_id, product_name, product_price, gu, p.dong 
		, product_datetime, product_image1
		FROM Product p JOIN Product_board pb
		ON p.product_id = pb.product_id
		JOIN Member m
		ON p.member_id = m.member_id
		WHERE 
		<if test="sId != ''">
			gu = (SELECT SUBSTRING_INDEX(SUBSTRING_INDEX(member_address, ' ', -2), ' ', 1) AS member_address
			FROM Member
			WHERE member_id = #{sId})		
		</if>
		<choose>
			<when test="category != ''">
				AND product_category = #{category}	
			</when>
			<when test="keyword != ''" >
				AND product_name LIKE '%${keyowrd}%' 
			</when>
			<otherwise>
				1+1
			</otherwise>
		</choose>
		ORDER BY product_datetime DESC
		LIMIT #{page.startRow}, #{page.listLimit}
	</select>
	
	
	
	<!-- ================================================================================= -->
	<!-- 상품 등록 - INSERT -->
	<insert id="productInsert">
		INSERT INTO Product
		VALUES (
			null
			, 'admin'
			, #{product_name}
			, #{product_price}
			, #{product_txt}
			, #{product_category}
			, #{tag_name}
			, #{product_image1} 
	        , <if test="product_image2 != null">#{product_image2}</if><if test="product_image2 == null">NULL</if> 
	        , <if test="product_image3 != null">#{product_image3}</if><if test="product_image3 == null">NULL</if>
	        , <if test="product_image4 != null">#{product_image4}</if><if test="product_image4 == null">NULL</if>
	        , <if test="product_image5 != null">#{product_image5}</if><if test="product_image5 == null">NULL</if>
			, now()
			, #{trade_method}
			, #{product_status}
			, #{gu}
			, #{dong}
			, 0
		)
	</insert>	
		
	<insert id="productBoardInsert">
		INSERT INTO Product_board
		values (
			null
			,(SELECT max(product_id)
			 FROM Product)
			,0
			,0
			,0
		);
	</insert>
		
	<select id="selectProduct" resultType="hashMap">
		SELECT *
		FROM Product
		WHERE product_id = 44;
	</select>
	
	<select id="selectProduct2" resultType="map">
		SELECT *
		FROM Product
		WHERE product_id = 44;
	</select>

</mapper>